{% extends 'partners/_layout.html' %}

{% block partner_title %}My Cases - {{ organization.name }} | Imara{% endblock %}

{% block partner_content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-6 flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-imara-deep dark:text-imara-gold">
                <i class="bi bi-person-check mr-2"></i> My Cases
            </h1>
            <p class="text-gray-500 mt-1">All cases assigned to {{ organization.name }}</p>
        </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6">
        <div class="glass-panel p-4 text-center">
            <div class="text-xl font-bold">{{ stats.open }}</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Open</div>
        </div>
        <div class="glass-panel p-4 text-center">
            <div class="text-xl font-bold">{{ stats.claimed }}</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Claimed</div>
        </div>
        <div class="glass-panel p-4 text-center">
            <div class="text-xl font-bold">{{ stats.in_progress }}</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">In Progress</div>
        </div>
        <div class="glass-panel p-4 text-center">
            <div class="text-xl font-bold">{{ stats.resolved }}</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Resolved</div>
        </div>
        <div class="glass-panel p-4 text-center">
            <div class="text-xl font-bold">{{ stats.closed }}</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">Closed</div>
        </div>
    </div>

    {% if cases %}
    <div class="space-y-4">
        {% for case in cases %}
        <a href="{% url 'partners:case_detail' case.id %}" class="block">
            <div class="glass-panel p-5 border-l-4 {% if case.risk_score >= 8 %}border-red-500{% elif case.risk_score >= 5 %}border-yellow-500{% else %}border-green-500{% endif %} hover:shadow-lg transition-all">
                <div class="flex justify-between items-start gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="font-mono text-sm text-gray-500">#{{ case.case_id|truncatechars:12 }}</span>
                            <span class="px-2 py-0.5 text-xs font-bold rounded-full {% if case.risk_score >= 8 %}bg-red-100 text-red-800{% elif case.risk_score >= 5 %}bg-yellow-100 text-yellow-800{% else %}bg-green-100 text-green-800{% endif %}">
                                Risk: {{ case.risk_score }}/10
                            </span>
                            <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300">
                                {{ case.get_status_display }}
                            </span>
                            {% if case.detected_location %}
                            <span class="text-xs text-gray-500">
                                <i class="bi bi-geo-alt"></i> {{ case.detected_location }}
                            </span>
                            {% endif %}
                        </div>

                        <p class="text-gray-700 dark:text-gray-300">
                            {{ case.original_text|default:case.transcribed_text|default:case.extracted_text|truncatechars:180 }}
                        </p>

                        <div class="flex items-center gap-4 text-xs text-gray-500 mt-3">
                            <span><i class="bi bi-clock"></i> {{ case.created_at|timesince }} ago</span>
                            <span><i class="bi bi-{{ case.source }}"></i> {{ case.get_source_display }}</span>
                            {% if case.chain_hash %}
                            <span class="font-mono" title="SHA-256: {{ case.chain_hash }}">
                                <i class="bi bi-shield-lock"></i> {{ case.chain_hash|truncatechars:12 }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-imara-gold">
                        <i class="bi bi-chevron-right"></i>
                    </div>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="glass-panel p-12 text-center">
        <h2 class="text-2xl font-bold text-imara-deep dark:text-imara-cream mb-2">No cases yet</h2>
        <p class="text-gray-500">When you claim cases from the pool, they will show up here.</p>
        <a href="{% url 'partners:pool' %}" class="inline-block mt-4 text-imara-gold hover:underline">
            View Case Pool â†’
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

