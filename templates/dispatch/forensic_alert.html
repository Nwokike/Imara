<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f5f5;">
    <table width="100%" cellpadding="0" cellspacing="0" style="max-width: 650px; margin: 0 auto; background-color: #ffffff;">
        <tr>
            <td style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px; text-align: center;">
                <h1 style="color: #ffffff; margin: 0; font-size: 24px; letter-spacing: 2px;">
                    OFFICIAL FORENSIC ALERT
                </h1>
                <p style="color: #e94560; margin: 10px 0 0 0; font-size: 16px; font-weight: bold;">
                    PROJECT IMARA - Digital Safety System
                </p>
            </td>
        </tr>
        
        <tr>
            <td style="background-color: {{ risk_color }}; padding: 15px; text-align: center;">
                <span style="color: #ffffff; font-size: 18px; font-weight: bold;">
                    {{ risk_level }} THREAT DETECTED - IMMEDIATE ATTENTION REQUIRED
                </span>
            </td>
        </tr>
        
        <tr>
            <td style="padding: 30px;">
                <table width="100%" style="border-collapse: collapse; margin-bottom: 25px;">
                    <tr>
                        <td style="padding: 12px; background-color: #f8f9fa; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Case ID:</strong>
                            <span style="color: #495057; font-family: monospace;">{{ case_id|slice:":8"|upper }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; background-color: #ffffff; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Timestamp:</strong>
                            <span style="color: #495057;">{{ timestamp }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; background-color: #f8f9fa; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Source:</strong>
                            <span style="color: #495057;">{{ source }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; background-color: #ffffff; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Detected Location:</strong>
                            <span style="color: #495057;">{{ location|default:'Unknown' }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; background-color: #f8f9fa; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Threat Type:</strong>
                            <span style="color: #495057; text-transform: uppercase;">{{ threat_type|default:'Unclassified' }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; background-color: #ffffff; border-left: 4px solid #e94560;">
                            <strong style="color: #1a1a2e;">Risk Score:</strong>
                            <span style="color: {{ risk_color }}; font-weight: bold; font-size: 18px;">{{ risk_score }}/10</span>
                        </td>
                    </tr>
                </table>
                
                <div style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 25px;">
                    <h3 style="color: #856404; margin: 0 0 10px 0; font-size: 14px;">AI THREAT SUMMARY</h3>
                    <p style="color: #856404; margin: 0; font-size: 14px;">{{ summary }}</p>
                </div>

                <!-- Agent Reasoning Trail -->
                <div style="margin-bottom: 25px; padding: 15px; background-color: #f0f4f8; border-radius: 8px; border: 1px solid #d1d9e6;">
                    <h3 style="color: #2d3748; margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase;">Agent Reasoning Trail (2026 Pro)</h3>
                    <ul style="margin: 0; padding-left: 20px; color: #4a5568; font-size: 12px; line-height: 1.6;">
                        <li><strong>Sentinel Agent:</strong> {{ safety_check.reasoning|default:'Policy check passed' }}</li>
                        {% if translation %}
                        <li><strong>Linguist Agent:</strong> {{ translation|truncatechars:100 }}</li>
                        {% endif %}
                        <li><strong>Navigator Agent:</strong> Jurisdiction matched to {{ location|default:'Unknown' }}</li>
                        {% if vision_analysis %}
                        <li><strong>Visionary Agent:</strong> OCR extracted {{ vision_analysis.extracted_text|truncatechars:100 }}</li>
                        {% endif %}
                        <li><strong>Forensic Agent:</strong>Urgency {{ risk_score }}/10. Recommendation: {{ action }}</li>
                    </ul>
                </div>
                
                <div style="background-color: #1a1a2e; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                    <h3 style="color: #e94560; margin: 0 0 15px 0; font-size: 14px; text-transform: uppercase;">EVIDENCE CONTENT</h3>
                    <div style="background-color: #16213e; border-radius: 4px; padding: 15px; border-left: 3px solid #e94560;">
                        <pre style="color: #ffffff; margin: 0; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5;">{{ evidence_text|default:'No text content available' }}</pre>
                    </div>
                </div>
                
                <div style="background-color: #d4edda; border: 1px solid #28a745; border-radius: 8px; padding: 15px; margin-bottom: 25px;">
                    <h3 style="color: #155724; margin: 0 0 10px 0; font-size: 14px;">CHAIN OF CUSTODY VERIFICATION</h3>
                    <p style="color: #155724; margin: 0; font-size: 12px;">
                        <strong>SHA-256 Hash:</strong><br>
                        <code style="background-color: #c3e6cb; padding: 5px 10px; border-radius: 4px; font-size: 11px; word-break: break-all;">{{ chain_hash|default:'Not yet computed' }}</code>
                    </p>
                    <p style="color: #155724; margin: 10px 0 0 0; font-size: 11px;">
                        This cryptographic hash ensures evidence integrity and can be used for legal verification.
                    </p>
                </div>
                
                <div style="background-color: #f8d7da; border: 1px solid #dc3545; border-radius: 8px; padding: 15px;">
                    <h3 style="color: #721c24; margin: 0 0 10px 0; font-size: 14px;">ACTION REQUIRED</h3>
                    <p style="color: #721c24; margin: 0; font-size: 13px;">
                        This report has been automatically flagged due to potential threats against a woman or girl. 
                        Please review the evidence and take appropriate action according to your jurisdiction's protocols.
                    </p>
                </div>
            </td>
        </tr>
        
        <tr>
            <td style="background-color: #1a1a2e; padding: 25px; text-align: center;">
                <p style="color: #ffffff; margin: 0 0 10px 0; font-size: 14px; font-weight: bold;">
                    Project Imara - Protecting Against Online Gender-Based Violence
                </p>
                <p style="color: #a0a0a0; margin: 0; font-size: 11px;">
                    "Imara" means "Strong" in Swahili. Together, we stand against online gender-based violence.
                </p>
                <p style="color: #a0a0a0; margin: 10px 0 0 0; font-size: 10px;">
                    This is an automated alert from Project Imara's AI-powered threat detection system.
                    <br>Report generated: {{ timestamp }}
                </p>
            </td>
        </tr>
    </table>
</body>
</html>
